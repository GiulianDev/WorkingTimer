<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>timer documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css" media="(prefers-color-scheme: dark)">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">timer documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">







<ol class="breadcrumb">
  <li>Injectables</li>
  <li >AlarmService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/SERVICE/Alarm/alarm.service.ts</code>
        </p>





            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Optional</span>
                                <a href="#_alarms" >_alarms</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#offset" >offset</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#checkForAlarm" >checkForAlarm</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#pushNotification" >pushNotification</a>
                            </li>
                        </ul>
                    </td>
                </tr>





                    <tr>
                        <td class="col-md-4">
                            <h6><b>Accessors</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                    <a href="#Alarms" >Alarms</a>
                                </li>
                                <li>
                                    <a href="#alarmsIdx" >alarmsIdx</a>
                                </li>
                                <li>
                                    <a href="#lastAlarm" >lastAlarm</a>
                                </li>
                                <li>
                                    <a href="#currentTimeIndex" >currentTimeIndex</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(storageService: <a href="../injectables/StorageService.html" target="_self">StorageService</a>, notificationService: <a href="../injectables/NotificationService.html" target="_self">NotificationService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="21" class="link-to-prism">src/app/SERVICE/Alarm/alarm.service.ts:21</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>When the service is instantiated =&gt; Alarms are retrived from the storage</p>
</div>
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>storageService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/StorageService.html" target="_self" >StorageService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>notificationService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/NotificationService.html" target="_self" >NotificationService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="checkForAlarm"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span ><b>checkForAlarm</b></span>
                        <a href="#checkForAlarm"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>checkForAlarm(counter: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="76"
                            class="link-to-prism">src/app/SERVICE/Alarm/alarm.service.ts:76</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Check if is too late or too early for the working day</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>counter</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../interfaces/IReturnMsg.html" target="_self" >IReturnMsg</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="pushNotification"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span ><b>pushNotification</b></span>
                        <a href="#pushNotification"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>pushNotification(counter: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="111"
                            class="link-to-prism">src/app/SERVICE/Alarm/alarm.service.ts:111</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>counter</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section>
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="_alarms"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Optional</span>
                        <span ><b>_alarms</b></span>
                        <a href="#_alarms"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../classes/Alarms.html" target="_self" >Alarms</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>new Alarms()</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="17" class="link-to-prism">src/app/SERVICE/Alarm/alarm.service.ts:17</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="offset"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>offset</b></span>
                        <a href="#offset"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Default value : </i><code>5</code>
                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="21" class="link-to-prism">src/app/SERVICE/Alarm/alarm.service.ts:21</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

            <section>
    <h3 id="accessors">
        Accessors
    </h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="Alarms"></a>
                        <span class="name"><b>Alarms</b><a href="#Alarms"><span class="icon ion-ios-link"></span></a></span>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>get</b><code>Alarms()</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="41" class="link-to-prism">src/app/SERVICE/Alarm/alarm.service.ts:41</a></div>
                                </td>
                            </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>set</b><code>Alarms(alarms: <a href="../classes/Alarm.html" target="_self">Alarm[]</a>)</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="65" class="link-to-prism">src/app/SERVICE/Alarm/alarm.service.ts:65</a></div>
                                </td>
                            </tr>
                    <tr>
                        <td class="col-md-4">

                                <div class="io-description">
                                        <b>Parameters :</b>
                                        <table class="params">
                                            <thead>
                                                <tr>
                                                    <td>Name</td>
                                                        <td>Type</td>
                                                    <td>Optional</td>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                    <tr>
                                                            <td>alarms</td>
                                                    
                                                            <td>
                                                                            <code><a href="../classes/Alarm.html" target="_self" >Alarm[]</a></code>
                                                            </td>
                                                    
                                                        <td>
                                                                No
                                                        </td>
                                                        
                                                    </tr>
                                            </tbody>
                                        </table>
                                </div>
                                <div>
                                </div>
                                <div class="io-description">
                                    <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                                </div>
                        </td>
                    </tr>
            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="alarmsIdx"></a>
                        <span class="name"><b>alarmsIdx</b><a href="#alarmsIdx"><span class="icon ion-ios-link"></span></a></span>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>get</b><code>alarmsIdx()</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="45" class="link-to-prism">src/app/SERVICE/Alarm/alarm.service.ts:45</a></div>
                                </td>
                            </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="lastAlarm"></a>
                        <span class="name"><b>lastAlarm</b><a href="#lastAlarm"><span class="icon ion-ios-link"></span></a></span>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>get</b><code>lastAlarm()</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="49" class="link-to-prism">src/app/SERVICE/Alarm/alarm.service.ts:49</a></div>
                                </td>
                            </tr>

            </tbody>
        </table>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                        <a name="currentTimeIndex"></a>
                        <span class="name"><b>currentTimeIndex</b><a href="#currentTimeIndex"><span class="icon ion-ios-link"></span></a></span>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <span class="accessor"><b>get</b><code>currentTimeIndex()</code></span>
                    </td>
                </tr>
                            <tr>
                                <td class="col-md-4">
                                    <div class="io-line">Defined in <a href="" data-line="54" class="link-to-prism">src/app/SERVICE/Alarm/alarm.service.ts:54</a></div>
                                </td>
                            </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-description"><p>Get the current hour and minutes as number index (ex. 13:15 =&gt; 1315)</p>
</div>

                        </td>
                    </tr>

            </tbody>
        </table>
</section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable } from &#x27;@angular/core&#x27;;
import { Utility } from &#x27;src/app/COMMON/Utility&#x27;;
import { Alarm } from &#x27;src/app/MODELS/CLASSES/Alarm&#x27;;
import { Alarms } from &#x27;src/app/MODELS/CLASSES/Alarms&#x27;;
import { IReturnMsg } from &#x27;src/app/MODELS/INTERFACES/IReturnMsg&#x27;;
import { NotificationService } from &#x27;../Notification/notification.service&#x27;;
import { StorageService } from &#x27;../Storage/storage.service&#x27;;

@Injectable({
  providedIn: &#x27;root&#x27;
})
/**
 * L&#x27;alrm service deve fare da itermediario tra la classe Alarm e lo storage service
 */
export class AlarmService {
  
  private _alarms?: Alarms &#x3D; new Alarms();

  // ToDo
  // let User manage the offset
  private offset: number &#x3D; 5;

  /**
   * When the service is instantiated &#x3D;&gt; Alarms are retrived from the storage
   * @param storageService 
   */
  constructor(
    private storageService: StorageService,
    private notificationService: NotificationService
    ) { 
    this.storageService.getStoredAlarm()
    .then(alarms &#x3D;&gt; {
      if (alarms !&#x3D; null) {
        this.Alarms &#x3D; alarms;
      }
      console.log(&quot;Alarms: &quot;, this._alarms);
    });
  }

  //#region _________GET______________________________________
  public get Alarms(): Alarm[] {
    return this._alarms.alarms;
  }

  public get alarmsIdx(): number[] {
    return this._alarms.alarmsIdx;
  }

  get lastAlarm(): Alarm {
    return this.Alarms[this.Alarms.length - 1];
  }

  /** Get the current hour and minutes as number index (ex. 13:15 &#x3D;&gt; 1315) */
  get currentTimeIndex() {
    let current &#x3D; new Date();
    let hour &#x3D; current.getHours()
    let min &#x3D; current.getMinutes()
    let dateStr &#x3D; Utility.zeroPrefix(hour, 2) + &quot;:&quot; + Utility.zeroPrefix(min, 2);
    let dateIdx &#x3D; Utility.timeToIndex(dateStr);
    return dateIdx;
  }
  //#endregion

  //#region _________SET______________________________________
  public set Alarms(alarms: Alarm[]) {
    this._alarms.alarms &#x3D; alarms;
  }
  //#endregion
  

  /**
   * Check if is too late or too early for the working day
   * @param index alarm position index in the alarms array
   * @returns 
   */
  public checkForAlarm(counter: number): IReturnMsg {
    let alarm &#x3D; this.alarmsIdx[counter];
    let currentTime: number &#x3D; this.currentTimeIndex;
    let msg &#x3D; null;
    if (counter &#x3D;&#x3D; this.alarmsIdx.length - 1) {
      msg &#x3D; &quot;This is the end!&quot;;
      let res &#x3D; {succeded: false, msg: msg};
        return res;
    }
    if (alarm) {
      console.log(&quot;Scheduled alarm: &quot;, alarm);
      console.log(&quot;Current index: &quot;, currentTime);
      if (currentTime &lt; (alarm - this.offset)) {
        msg &#x3D;  &quot;Not time yet!&quot;;
        let res &#x3D; {succeded: true, msg: msg};
        return res;
      }
      // check if it is too late for today working day
      if (currentTime &gt; (this.lastAlarm.index)) {
        msg &#x3D; &quot;You are out of your working hours!&quot;;
        let res &#x3D; {succeded: true, msg: msg};
        return res;
      }
      msg &#x3D; &quot;Successfull&quot;;
      let res &#x3D; {succeded: true, msg: msg};
      return res;

    } else {
      msg &#x3D; &quot;No alarms found!&quot;;
      let res &#x3D; {succeded: true, msg: msg};
      return res;
    }
  }


  public pushNotification(counter: number) {
    console.log(&quot;pushing notification...&quot;);
    let alarmIdx &#x3D; this.alarmsIdx[counter];
    let test &#x3D; Utility.index2time(alarmIdx);
    this.notificationService.addNotification(test)
  }











  // public Reset() {
  //   this.GetStoredAlarms();
  // }

  // public ResetDefault() {
  //   this.SetDefaultAlarms();
  // }


  //#region PRIVATE METHOD
  
  // private GetStoredAlarms(): Promise&lt;Alarm[]&gt; {
  //   // return this.storageService.getStoredData(KEYS.ALARMS);
  // }

  // private Save() {
  //   this.storageService.SaveAlarms(this.Alarms);
  // }

  // private get DefaultAlarms(): Alarm[] {
  //   console.log(&#x27;Loading default alarm values...&#x27;);
  //   let alarmsTmp: Alarm[] &#x3D; [];
  //   // this._alarms.clear();
  //   // Default starting time
  //   const start: Alarm &#x3D; new Alarm(LABELS.START, DEFAULT_VAL.START, false);
  //   alarmsTmp.push(start);
  //   // Default stopping time
  //   const end: Alarm &#x3D; new Alarm(LABELS.STOP, DEFAULT_VAL.STOP, false);
  //   alarmsTmp.push(end);
  //   console.log(&#x27;Default alarms: &#x27;, this._alarms);
  //   // Saving on storage
  //   // this.Save();
  //   return alarmsTmp;
  // }

  //#endregion













  // ToDo
  // miglirabole
  // /**
  // * Update Alarm by positional index
  // * @param val string
  // * @param idx number
  // */
  //  public updateAlaram(val: string, idx: number) {
  //   this.alarms[idx].update(val);
  // };





  // public updateAlarm(value: string, idx: number &#x3D; null) {
  //   // this._alarms.update(value);
  // }

  // ToDo
  // deve diventare una insert/add alarm

  // /**
  // * 
  // * @param key Create a new Alarm
  // * @param value 
  // * @param isPause 
  // * @param duration 
  // * @returns 
  // */
  // public createAlarm (key: string &#x3D; null, value: string &#x3D; null, isPause: boolean &#x3D; null, duration: number &#x3D; null): Alarm {
  //   var alarm: Alarm &#x3D; new Alarm(key, value, true); 
  //   return alarm;
  // }
  
  
  
  // ToDo
  // trovare una soluzione differente per capire se siamo dentro a fuori il range degli allarmi
  // per poi gestre i messaggi


  
  
  
  
}
</code></pre>
    </div>

</div>







                   




                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'AlarmService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       
       <script type="module" src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
